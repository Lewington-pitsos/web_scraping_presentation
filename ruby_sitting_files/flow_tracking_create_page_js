define('ext.wikia.flowTracking.createPageTracking',['wikia.flowTracking','wikia.querystring','mw','wikia.document','wikia.window'],function(flowTrack,QueryString,mw,document,window){'use strict';var namespaceId=mw.config.get('wgNamespaceNumber'),articleId=mw.config.get('wgArticleId'),title=mw.config.get('wgTitle');function trackOnEditPageLoad(editor){var qs=new QueryString(window.location),flowParam=qs.getVal('flow',false),tracked=qs.getVal('tracked',false);if(tracked||!isNewArticle()||!isMainNamespace()){return;}if(flowParam||document.referrer){flowTrack.trackFlowStep(flowParam,{editor:editor});}else{flowTrack.beginFlow(window.wgFlowTrackingFlows.CREATE_PAGE_DIRECT_URL,{editor:editor});qs.setVal('flow',window.wgFlowTrackingFlows.CREATE_PAGE_DIRECT_URL);}setTrackedQueryParam(qs);}function trackOnSpecialCreatePageLoad(editor,title){var qs=new QueryString(window.location),flowParam=qs.getVal('flow',false),tracked=qs.getVal('tracked',false);if(tracked||!isAllowedSpecialPage()||!
isTitleInMainNamespace(title)){return;}if(flowParam){flowTrack.trackFlowStep(flowParam,{editor:editor});}else{flowTrack.beginFlow(window.wgFlowTrackingFlows.CREATE_PAGE_SPECIAL_CREATE_PAGE,{editor:editor});qs.setVal('flow',window.wgFlowTrackingFlows.CREATE_PAGE_SPECIAL_CREATE_PAGE);}setTrackedQueryParam(qs);}function setTrackedQueryParam(qs){qs.setVal('tracked','true');window.history.replaceState({},'',qs.toString());}function isNewArticle(){return articleId===0;}function isAllowedSpecialPage(){return namespaceId===-1&&title==='CreatePage';}function isMainNamespace(){return namespaceId===0;}function isTitleInMainNamespace(title){var namespace;title=title||'';if(title.indexOf(':')){namespace=title.split(':')[0].toLowerCase();if(window.wgNamespaceIds[namespace]){return false;}}return true;}return{trackOnEditPageLoad:trackOnEditPageLoad,trackOnSpecialCreatePageLoad:trackOnSpecialCreatePageLoad}});;require(['wikia.flowTracking','ext.wikia.flowTracking.createPageTracking',
'wikia.querystring','mw','jquery','wikia.window'],function(flowTracking,flowTrackingCreatePage,QueryString,mw,$,window){var redLinkFlow=mw.config.get('wgNamespaceNumber')===-1?window.wgFlowTrackingFlows.CREATE_PAGE_SPECIAL_REDLINK:window.wgFlowTrackingFlows.CREATE_PAGE_ARTICLE_REDLINK,createButtonFlow=window.wgFlowTrackingFlows.CREATE_PAGE_CREATE_BUTTON,createboxFlow=window.wgFlowTrackingFlows.CREATE_PAGE_CREATE_BOX,inputBoxFlow=window.wgFlowTrackingFlows.CREATE_PAGE_INPUT_BOX;function init(){var $wikiaArticle=$('#WikiaArticle');$wikiaArticle.find('a.new').each(function(index,redlink){var qs=QueryString(redlink.href);qs.setVal('flow',redLinkFlow);redlink.href=qs.toString();});$wikiaArticle.on('mousedown','a.new',function(e){if(e.which===3){return;}flowTracking.beginFlow(redLinkFlow,{});});$('form.createboxForm .createboxButton').click(function(){flowTracking.beginFlow(createboxFlow,{});});$('form.createbox').submit(function(){var flowInput=document.createElement('input');flowInput.
setAttribute('type','hidden');flowInput.setAttribute('name','flow');flowInput.setAttribute('value',inputBoxFlow);this.appendChild(flowInput);flowTracking.beginFlow(inputBoxFlow,{});});$('#ca-edit').on('mousedown',function(){if(isNewArticle()&&isMainNamespace()){flowTracking.beginFlow(createButtonFlow,{});}});$('#ca-ve-edit').click(function(){if(isNewArticle()&&isMainNamespace()){var qs=new QueryString();flowTracking.beginFlow(createButtonFlow,{});qs.removeVal('tracked');window.history.replaceState({},'',qs.toString());}});}function initVEHooks(){mw.hook('ve.activationComplete').add(function(){flowTrackingCreatePage.trackOnEditPageLoad('visualeditor');});mw.hook('ve.deactivationComplete').add(function(){var qs=new QueryString(),flow=qs.getVal('flow');if(flow){qs.removeVal('flow');qs.removeVal('tracked');window.history.replaceState({},'',qs.toString())}});mw.hook('ve.afterVEInit').add(function(veEditUri){if(!mw.config.get('wgArticleId')){veEditUri.extend({flow:createButtonFlow});}});}
function isNewArticle(){return mw.config.get('wgArticleId')===0;}function isMainNamespace(){return mw.config.get('wgNamespaceNumber')===0;}$(function(){init();initVEHooks();});});;define('wikia.flowTracking',['wikia.log','wikia.tracker','wikia.window','mw','jquery'],function(log,tracker,w,mw,$){'use strict';var flows={CREATE_PAGE_DIRECT_URL:'create-page-direct-url'},track=tracker.buildTrackingFunction({category:'flow-tracking',trackingMethod:'analytics'}),userAgent=w.navigator.userAgent,logGroup='wikia.flowTracking';function beginFlow(flow,extraParams){track(prepareParams(tracker.ACTIONS.FLOW_START,flow,extraParams));}function trackFlowStep(flow,extraParams){track(prepareParams(tracker.ACTIONS.FLOW_MID_STEP,flow,extraParams));}function prepareParams(action,flow,extraParams){var params={action:action,flowname:flow,label:flow};extraParams=extraParams||{};params=$.extend(params,extraParams,{useragent:userAgent});log(['prepareParams',params],'debug',logGroup);return params;}return{
beginFlow:beginFlow,trackFlowStep:trackFlowStep,flows:flows};});;